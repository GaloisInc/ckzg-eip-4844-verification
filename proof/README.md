# Software Analysis Workbench (SAW) Verification

## Installation

Download the SAW binary from the [SAW website](https://saw.galois.com).

You will also need to install the Java Runtime Environment (this is required for running SAW with Java even if this feature is not used).

You will also need to have Clang installed.

You may also need to install [Yices](https://yices.csl.sri.com).

### MacOS

For mac users, make sure to install `llvm@16` from Homebrew.

```bash

 $> brew install llvm@16

```

You also need to ensure that your CC environment variable is pointing to the installed version above.

## Generating the Bit-code

SAW performs verification by first running symbolic execution on the C LLVM bit-code to generate a model of the computation. SAW then tries to prove this model equivalent to the corresponding model generated by the Cryptol specification using a backend SMT solver (default is Z3).

So we need to generate the LLVM bit-code for the C code we want to verify. That is done by the following command:

```bash
clang -g -O1 -c -emit-llvm file.c -o file.bc
```

For convenience, we have a Makefile in the `bitcode` subfolder that can autogenerate the needed LLVM bitcode. Run the following:

```bash
make bc
```

You'll see the following output:

```text
cp ckzg-src-makefile.patch ../../c-kzg-4844/src/makefile.patch
cd ../../c-kzg-4844/src && git apply makefile.patch && /.../usr/bin/make bc
[+] generating bitcode
cp ../../c-kzg-4844/src/ckzg.bc ckzg.bc
```

## Running the proofs

To execute a SAW script and check the proofs, run the following command:

```bash
saw file.saw
```

Any dependent Cryptol modules will be compiled first, and any errors will immediately end the executation and be reported.

### Example SAW run

Running the following command:

```bash
saw permutations.saw
```

Results in output similar to:

```text
[14:45:20.052] Loading file ".../proof/permutations.saw"
[14:45:20.194] Verifying is_power_of_two ...
[14:45:20.204] Simulating is_power_of_two ...
[14:45:20.232] Checking proof obligations is_power_of_two ...
[14:45:20.333] Proof succeeded! is_power_of_two
[14:45:20.359] Verifying reverse_bits ...
[14:45:20.366] Simulating reverse_bits ...
[14:45:20.381] Checking proof obligations reverse_bits ...
[14:45:20.409] Proof succeeded! reverse_bits
[14:45:20.478] Verifying reverse_bits_limited ...
[14:45:20.484] Simulating reverse_bits_limited ...
[14:45:20.492] Registering overrides for `reverse_bits`
[14:45:20.492]   variant `Symbol "reverse_bits"`
[14:45:20.631] Checking proof obligations reverse_bits_limited ...
[14:45:20.857] Proof succeeded! reverse_bits_limited
```
